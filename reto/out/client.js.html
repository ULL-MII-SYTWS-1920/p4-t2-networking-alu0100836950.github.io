<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: client.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: client.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var readline = require('readline');
var socketio = require('socket.io-client');
util = require('util');
color = require("ansi-color").set;
 
 
var nick;
var socket = socketio.connect('localhost', { port: 3636 });
var rl = readline.createInterface(process.stdin, process.stdout);

/**
 * @function
 * @name console_out
 * @param {string} msg 
 * @description Creamos esta funcion porque Readline no funciona bien con el metodo prompt y se le pasa la salida a esta funcion.
 */
function console_out(msg) {
    process.stdout.clearLine();
    process.stdout.cursorTo(0);
    console.log(msg);
    rl.prompt(true);
}

/**
 * @function
 * @name chat_command
 * @description Analizamos la entrada de los usuarios si es un comando
 * especial
 * @param {string} cmd Comando
 * @param {string} arg Argumento del comando
 */
function chat_command(cmd, arg) {
    switch (cmd) {
 
        case 'nick':
            var notice = nick + " changed their name to " + arg;
            nick = arg;
            socket.emit('send', { type: 'notice', message: notice });
            break;
 
        case 'msg':
            var to = arg.match(/[a-z]+\b/)[0];
            var message = arg.substr(to.length, arg.length);
            socket.emit('send', { type: 'tell', message: message, to: to, from: nick });
            break;
 
        case 'me':
            var emote = nick + " " + arg;
            socket.emit('send', { type: 'emote', message: emote });
            break;
 
        default:
            console_out("That is not a valid command.");
 
    }
}

/**
 * @function
 * @name question
 * @description Pedimos al usuario un nickname, creamos un mensaje de respuesta y lo enviamos
 * a los demÃ¡s usuarios conectados a traves de nuestro socket.emit
 * @param {string} text
 * @param {function} function 
 */
rl.question("Please enter a nickname: ", function(name) {
    nick = name;
    var msg = nick + " has joined the chat";
    socket.emit('send', { type: 'notice', message: msg });
    rl.prompt(true);
});


/**
 * @function
 * @name on_line
 * @description Leemos la entrada del cliente conectado
 * @param {string} line
 * @param {function} function
 */
rl.on('line', function (line) {
    if (line[0] == "/" &amp;&amp; line.length > 1) {
        var cmd = line.match(/[a-z]+\b/)[0];
        var arg = line.substr(cmd.length+2, line.length);
        chat_command(cmd, arg);
 
    } else {
        // send chat message
        socket.emit('send', { type: 'chat', message: line, nick: nick });
        rl.prompt(true);
    }
});

/**
 * @function
 * @description Con esta funcion formateamos la salida del mensaje dependiendo de que tipo sea
 * @param {string} message Obtenemos el mensaje
 * @param {function} function Leemos el dato
 */

socket.on('message', function (data) {
    var leader;
    if (data.type == 'chat' &amp;&amp; data.nick != nick) {
        leader = color("&lt;"+data.nick+"> ", "green");
        console_out(leader + data.message);
    }
    else if (data.type == "notice") {
        console_out(color(data.message, 'cyan'));
    }
    else if (data.type == "tell" &amp;&amp; data.to == nick) {
        leader = color("["+data.from+"->"+data.to+"]", "red");
        console_out(leader + data.message);
    }
    else if (data.type == "emote") {
        console_out(color(data.message, "cyan"));
    }
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#chat_command">chat_command</a></li><li><a href="global.html#console_out">console_out</a></li><li><a href="global.html#on_line">on_line</a></li><li><a href="global.html#question">question</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Fri Jul 03 2020 13:06:14 GMT+0100 (hora de verano de Europa occidental)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
